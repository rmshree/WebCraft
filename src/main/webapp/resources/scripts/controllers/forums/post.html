<div ng-init="ctrl.init()" class="post-page">

    <div ng-if="!ctrl.postFound" class="col-xs-12 panel-body">
        <h3>This post does not exist anymore.</h3>
    </div>

    <div ng-if="ctrl.postFound">
        <div class=" page-header col-xs-12">
            <h3><a href="#/forums/">Forums</a> >> {{ctrl.title}} >> {{ctrl.post.title}}</h3>
        </div>

        <div class="col-md-3 col-xs-12 panel-body">
            <!-- User info -->
            <div class="col-xs-12" style="display: inline-block; padding-bottom: 10px; background-color: rgba(255,255,255,.1)">
                <!--<img ng-if="ctrl.post.user.artwork_url !== null" height="50px" width="50px" ng-src="{{ctrl.post.user.artwork_url}}">-->
                <img height="100px" width="100px" class="pull-left" style="margin-top: 10px; margin-right: 10px" src="resources/images/default_avatar.png">
                <div class="col-md-8" style="margin-top: 10px; padding: 0">
                    <h3>{{ctrl.post.user.username}}</h3>
                    <span>{{ctrl.post.date | date: 'medium'}}</span>
                </div>
            </div>
            <div ng-if="ctrl.currentUser.id == ctrl.post.user.id" >
                <button class="btn btn-primary pull-left" style="margin-top: 10px" ng-click="ctrl.post.showEditPostForm = true; ctrl.edittingPost = ctrl.post">Edit Post</button>
                <button ng-if="!ctrl.post.showDeletePostForm" class="btn btn-primary pull-left" style="margin-top: 10px" ng-click="ctrl.post.showDeletePostForm = true"> Delete Post </button>
            </div>
            <!-- Delete Post form -->
            <div ng-if="ctrl.post.showDeletePostForm" class="pull-left">
                <div class="form-group pull-left">
                    <label>Are you sure you want to delete this post?</label>
                </div>
                <!-- Buttons for the Delete Post form -->
                <div>
                    <button class="btn btn-primary pull-left" style="margin-right: 10px" ng-click="ctrl.deletePost(ctrl.post)" >Confirm</button>
                    <button class="btn btn-primary pull-left" ng-click="ctrl.post.showDeletePostForm = false">Cancel</button>
                </div>
            </div>
        </div>

        <div class="col-md-9 col-xs-12 panel-body">

            <!-- Text from the forum post -->
            <div class="jumbotron" style="margin-bottom: 0; background-color: rgba(255,255,255,.1)">
                <pre>{{ctrl.post.text}}</pre>
                <div ng-if="ctrl.post.filename && ctrl.post.fileURL">
                    <a href="{{ctrl.post.fileURL}}">{{ctrl.post.filename}}</a>
                </div>
            </div>

            <div ng-if ="ctrl.post.showEditPostForm" style="margin-top: 10px;margin-bottom: 0; background-color: rgba(255,255,255,.1)">
                <div class="form-group col-md-12">
                    <textarea id="editPost" class="form-control" maxlength="1000" rows="3" ng-model="ctrl.edittingPost.text">{{ctrl.edittingPost.text}}</textarea>
                </div>
                <div class="col-xs-12">
                    <button class="btn btn-primary" ng-click="ctrl.post.showMapForm = true">Upload File</button>
                    <button class="btn btn-primary" ng-click="ctrl.editPost(ctrl.edittingPost)" ng-disabled="!ctrl.edittingPost.text">Submit</button>
                    <button class="btn btn-primary" ng-click="ctrl.post.showEditPostForm = false; ctrl.uploading = false; ctrl.post.showMapForm = false; ctrl.edittingPost.file ='';">Cancel</button>
                </div>
                <div ng-if="ctrl.post.showMapForm" class="col-xs-12 col-md-6 panel-body">
                    <div class="col-xs-12 col-md-3">
                        <div class="form-group">
                            <label>File</label>
                            <input type="file" ngf-select ng-model="ctrl.edittingPost.file">
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-header col-xs-12" style="margin-top: 5px">
                <h3 style="display: inline-block">Comments <small class="badge" style="background-color: black">{{ctrl.post.comments.length}}</small></h3>
                <button class="btn btn-primary pull-right" style="margin-top: 20px" ng-if="!ctrl.post.showCommentForm" ng-click="ctrl.post.showCommentForm = true">Add Comment</button>

                <!-- Add comment form -->
                <div ng-if="ctrl.post.showCommentForm" class="col-xs-12 panel-body" style="padding: 0">
                    <!-- Text area for add comment form-->
                    <div class="form-group col-md-12">
                        <label for="comment">Text</label>
                        <textarea id="comment" class="form-control" maxlength="1000" rows="3" ng-model="newComment.text"></textarea>
                    </div>
                    <div ng-if="newComment.showUploadFile" class="col-xs-12 col-md-6 panel-body">
                        <div class="col-xs-12 col-md-3">
                            <div class="form-group">
                                <label>File</label>
                                <input type="file" ngf-select ng-model="newComment.file">
                            </div>
                        </div>
                    </div>
                    <!-- Buttons for the add comment form -->
                    <div class="col-xs-12">
                        <button class="btn btn-primary" ng-click="newComment.showUploadFile = true">Upload File</button>
                        <button class="btn btn-primary" ng-click="ctrl.addComment(ctrl.post, newComment)" ng-disabled="!newComment.text">Add</button>
                        <button class="btn btn-primary" ng-click="ctrl.post.showCommentForm = false">Cancel</button>
                    </div>
                </div>
            </div>


            <div ng-repeat="comment in ctrl.post.comments" class="col-xs-12" style="border-bottom: dashed .1em grey">
                <div class="col-md-3 col-xs-12" style="display: inline-block; padding-bottom: 10px">
                    <!--<img ng-if="comment.user.artwork_url !== null" height="50px" width="50px" ng-src="{{comment.user.artwork_url}}">-->
                    <img height="75px" width="75px" class="pull-left" style="margin-right: 10px" src="resources/images/noImage.jpg">
                    <div class="col-md-8" style="padding: 0">
                        <h5 style="color: white">{{comment.user.username}}</h5>
                        <span>{{comment.date | date: 'medium'}}</span>
                    </div>
                </div>
                <pre class="col-md-9 col-xs-12" style="font-family: 'Pontano Sans', sans-serif; margin-top: 10px; margin-bottom: 10px; color: lightgray;background-color: rgba(0,0,0,0); border-color: rgba(0,0,0,0); display:inline-block">{{comment.text}}</pre>
                <div ng-if="comment.filename && comment.fileURL">
                    <a href="{{comment.fileURL}}">{{comment.filename}}</a>
                </div>
                <div ng-if="ctrl.currentUser.id == comment.user.id" class="col-xs-12" style="margin-bottom: 10px; margin-top: 10px;">
                    <button class="btn btn-primary pull-right" style="margin: 5px" ng-click="comment.showEditCommentForm = true; comment.editText = comment.text;comment.showDeleteCommentForm = false">Edit Comment</button>
                    <button class="btn btn-primary pull-right" style="margin: 5px" ng-click="comment.showDeleteCommentForm = true;comment.showEditCommentForm = false">Delete Comment</button>
                </div>

                <!-- Edit comment -->
                <div ng-if="comment.showEditCommentForm" class="col-xs-12 panel-body" style="padding: 0">
                    <div class="form-group col-md-12">
                        <label for="editComment">Text</label>
                        <textarea id="editComment" class="form-control" maxlength="1000" rows="3" ng-model="comment.editText"></textarea>
                    </div>
                    <div class="col-xs-12">
                        <button class="btn btn-primary" ng-click="comment.showMapForm = true">Upload File</button>
                        <button class="btn btn-primary" ng-click="ctrl.editComment(comment)" ng-disabled="!comment.editText">Submit</button>
                        <button class="btn btn-primary" ng-click="comment.showEditCommentForm = false; ctrl.uploading = false; comment.file = '';">Cancel</button>
                    </div>
                    <div ng-if="comment.showMapForm" class="col-xs-12 col-md-6 panel-body">
                        <div class="col-xs-12 col-md-3">
                            <div class="form-group">
                                <label>File</label>
                                <input type="file" ngf-select ng-model="comment.file">
                            </div>
                        </div>
                        </div>
                    </div>

                <!-- Delete comment -->
                <div ng-if="comment.showDeleteCommentForm" class="col-xs-12 panel-body" style="padding: 0">
                    <div class="form-group col-md-12">
                        <label style="horiz-align: center">Are you sure you want to delete this comment?</label>
                    </div>
                    <div class="col-xs-12" style="margin-bottom: 10px">
                        <button class="btn btn-danger" ng-click="ctrl.deleteComment(ctrl.post, comment)">Confirm</button>
                        <button class="btn btn-primary" ng-click="comment.showDeleteCommentForm = false">Cancel</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>